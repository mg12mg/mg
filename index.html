document.addEventListener('DOMContentLoaded', function() {
    // Simple fade slideshow
    const slides = document.querySelectorAll('.hero-slide');
    let currentSlide = 0;
    
    function showSlide(n) {
        slides[currentSlide].classList.remove('active');
        currentSlide = (n + slides.length) % slides.length;
        slides[currentSlide].classList.add('active');
    }
    
    function nextSlide() {
        showSlide(currentSlide + 1);
    }
    
    // Change slide every 5 seconds
    setInterval(nextSlide, 5000);
    
    // Side menu functionality
    const menuButton = document.getElementById('menuButton');
    const closeMenu = document.getElementById('closeMenu');
    const sideMenu = document.getElementById('sideMenu');
    const overlay = document.getElementById('overlay');
    
    menuButton.addEventListener('click', function() {
        sideMenu.classList.add('active');
        overlay.classList.add('active');
    });
    
    closeMenu.addEventListener('click', function() {
        sideMenu.classList.remove('active');
        overlay.classList.remove('active');
    });
    
    overlay.addEventListener('click', function() {
        sideMenu.classList.remove('active');
        overlay.classList.remove('active');
    });
    
    // Shopping cart functionality
    const cart = [];
    const cartCount = document.getElementById('cartCount');
    const cartIcon = document.getElementById('cartIcon');
    const checkoutModal = document.getElementById('checkoutModal');
    const closeCheckoutModal = document.getElementById('closeCheckoutModal');
    const whatsappCheckout = document.getElementById('whatsappCheckout');
    const continueShopping = document.getElementById('continueShopping');
    const orderSummary = document.getElementById('orderSummary');
    const orderTotal = document.getElementById('orderTotal');
    const emptyCartMessage = document.getElementById('emptyCartMessage');
    
    // Search functionality
    const searchInput = document.getElementById('searchInput');
    const allProducts = document.querySelectorAll('.product-item');
    
    searchInput.addEventListener('keyup', function(e) {
        const searchTerm = this.value.toLowerCase();
        
        allProducts.forEach(product => {
            const productName = product.querySelector('.product-name').textContent.toLowerCase();
            if (productName.includes(searchTerm)) {
                product.style.display = 'flex';
            } else {
                product.style.display = 'none';
            }
        });
    });
    
    // Initialize all category carousels with arrow navigation only
    function initCategoryCarousel(category) {
        const container = document.querySelector(`.${category}-products-container`);
        const scroll = document.querySelector(`.${category}-products-scroll`);
        const leftArrow = document.querySelector(`.${category}-left-arrow`);
        const rightArrow = document.querySelector(`.${category}-right-arrow`);
        const productItems = document.querySelectorAll(`.${category}-products-scroll .product-item`);
        
        if (!container || !scroll || !leftArrow || !rightArrow || productItems.length === 0) return;
        
        const productWidth = productItems[0].offsetWidth + 15;
        let currentPosition = 0;
        const maxScroll = scroll.scrollWidth - container.offsetWidth;
        
        function updateArrows() {
            leftArrow.classList.toggle('hidden', currentPosition <= 0);
            rightArrow.classList.toggle('hidden', currentPosition >= maxScroll);
        }
        
        leftArrow.addEventListener('click', () => {
            currentPosition = Math.max(0, currentPosition - (productWidth * 2));
            scroll.style.transform = `translateX(-${currentPosition}px)`;
            updateArrows();
        });
        
        rightArrow.addEventListener('click', () => {
            currentPosition = Math.min(maxScroll, currentPosition + (productWidth * 2));
            scroll.style.transform = `translateX(-${currentPosition}px)`;
            updateArrows();
        });
        
        updateArrows();
        
        window.addEventListener('resize', () => {
            currentPosition = 0;
            scroll.style.transform = `translateX(0)`;
            updateArrows();
        });
    }
    
    // Initialize carousels for all categories except best sellers
    initCategoryCarousel('men');
    initCategoryCarousel('women');
    initCategoryCarousel('children');
    
    // View All/Less functionality for each category
    setupCategoryView('men');
    setupCategoryView('women');
    setupCategoryView('children');
    
    function setupCategoryView(category) {
        const viewAllBtn = document.querySelector(`.view-all-${category}`);
        const backBtn = document.querySelector(`.back-to-${category}`);
        const categorySection = document.getElementById(`${category}Category`);
        const fullViewSection = document.getElementById(`${category}FullView`);
        
        if (!viewAllBtn || !backBtn || !categorySection || !fullViewSection) return;
        
        viewAllBtn.addEventListener('click', function(e) {
            e.preventDefault();
            categorySection.style.display = 'none';
            fullViewSection.classList.add('active');
            fullViewSection.scrollIntoView({ behavior: 'smooth' });
        });
        
        backBtn.addEventListener('click', function(e) {
            e.preventDefault();
            fullViewSection.classList.remove('active');
            categorySection.style.display = 'block';
            categorySection.scrollIntoView({ behavior: 'smooth' });
        });
    }
    
    // Category photo links
    document.getElementById('menCategoryLink').addEventListener('click', function(e) {
        e.preventDefault();
        document.getElementById('menCategory').style.display = 'none';
        document.getElementById('menFullView').classList.add('active');
        document.getElementById('menFullView').scrollIntoView({ behavior: 'smooth' });
    });
    
    document.getElementById('womenCategoryLink').addEventListener('click', function(e) {
        e.preventDefault();
        document.getElementById('womenCategory').style.display = 'none';
        document.getElementById('womenFullView').classList.add('active');
        document.getElementById('womenFullView').scrollIntoView({ behavior: 'smooth' });
    });
    
    document.getElementById('childrenCategoryLink').addEventListener('click', function(e) {
        e.preventDefault();
        document.getElementById('childrenCategory').style.display = 'none';
        document.getElementById('childrenFullView').classList.add('active');
        document.getElementById('childrenFullView').scrollIntoView({ behavior: 'smooth' });
    });
    
    // Product data - now with isBestSeller flag
    const products = {
        best1: { 
            name: "تيشيرت رجالي", 
            designer: "MG", 
            price: "199.99 جنيه", 
            images: ["https://i.postimg.cc/qqmTXMKG/Chat-GPT-Image-Jun-26-2025-12-06-23-PM.png"], 
            sizes: ["S", "M", "L", "XL"],
            description: "تيشيرت رجالي عالي الجودة من قطن 100%، مناسب لجميع المناسبات.",
            inStock: true,
            isBestSeller: true,
            category: "men"
        },
        best2: { 
            name: "بلوزة نسائية", 
            designer: "MG", 
            price: "149.99 جنيه", 
            images: ["https://i.postimg.cc/qqmTXMKG/Chat-GPT-Image-Jun-26-2025-12-06-23-PM.png"], 
            sizes: ["S", "M", "L"],
            description: "بلوزة نسائية أنيقة بتصميم عصري، مناسبة للعمل والمناسبات.",
            inStock: true,
            isBestSeller: true,
            category: "women"
        },
        best3: { 
            name: "جاكيت جلد", 
            designer: "MG", 
            price: "249.99 جنيه", 
            images: ["https://i.postimg.cc/qqmTXMKG/Chat-GPT-Image-Jun-26-2025-12-06-23-PM.png"], 
            sizes: ["M", "L"],
            description: "جاكيت جلد طبيعي بتصميم كلاسيكي يناسب جميع الأوقات.",
            inStock: false,
            isBestSeller: false,
            category: "men"
        },
        best4: { 
            name: "بنطال جينز", 
            designer: "MG", 
            price: "99.99 جنيه", 
            images: ["https://i.postimg.cc/qqmTXMKG/Chat-GPT-Image-Jun-26-2025-12-06-23-PM.png"], 
            sizes: ["28", "30", "32"],
            description: "بنطال جينز كلاسيكي بجودة عالية ومتانة طويلة الأمد.",
            inStock: true,
            isBestSeller: true,
            category: "men"
        },
        men1: { 
            name: "قميص رسمي", 
            designer: "MG", 
            price: "349.99 جنيه", 
            images: ["https://i.postimg.cc/qqmTXMKG/Chat-GPT-Image-Jun-26-2025-12-06-23-PM.png"], 
            sizes: ["S", "M", "L", "XL"],
            description: "قميص رسمي بجودة عالية يناسب المناسبات الرسمية والعمل.",
            inStock: true,
            isBestSeller: false,
            category: "men"
        },
        men2: { 
            name: "شورت صيفي", 
            designer: "MG", 
            price: "299.99 جنيه", 
            images: ["https://i.postimg.cc/qqmTXMKG/Chat-GPT-Image-Jun-26-2025-12-06-23-PM.png"], 
            sizes: ["M", "L"],
            description: "شورت صيفي مريح ومناسب للرحلات والأنشطة الصيفية.",
            inStock: true,
            isBestSeller: true,
            category: "men"
        },
        men3: { 
            name: "جاكيت رياضي", 
            designer: "MG", 
            price: "179.99 جنيه", 
            images: ["https://i.postimg.cc/qqmTXMKG/Chat-GPT-Image-Jun-26-2025-12-06-23-PM.png"], 
            sizes: ["L", "XL"],
            description: "جاكيت رياضي خفيف الوزن يناسب جميع الأنشطة الرياضية.",
            inStock: false,
            isBestSeller: false,
            category: "men"
        },
        women1: { 
            name: "فستان صيفي", 
            designer: "MG", 
            price: "249.99 جنيه", 
            images: ["https://i.postimg.cc/qqmTXMKG/Chat-GPT-Image-Jun-26-2025-12-06-23-PM.png"], 
            sizes: ["S", "M"],
            description: "فستان صيفي أنيق بتصميم عصري يناسب جميع المناسبات.",
            inStock: true,
            isBestSeller: true,
            category: "women"
        },
        women2: { 
            name: "بلوزة حرير", 
            designer: "MG", 
            price: "399.99 جنيه", 
            images: ["https://i.postimg.cc/qqmTXMKG/Chat-GPT-Image-Jun-26-2025-12-06-23-PM.png"], 
            sizes: ["M", "L"],
            description: "بلوزة حرير فاخرة بتصميم أنيق يناسب المناسبات الخاصة.",
            inStock: true,
            isBestSeller: false,
            category: "women"
        },
        women3: { 
            name: "جينز نسائي", 
            designer: "MG", 
            price: "179.99 جنيه", 
            images: ["https://i.postimg.cc/qqmTXMKG/Chat-GPT-Image-Jun-26-2025-12-06-23-PM.png"], 
            sizes: ["28", "30"],
            description: "جينز نسائي بتصميم عصري يناسب جميع الأوقات.",
            inStock: true,
            isBestSeller: true,
            category: "women"
        },
        children1: { 
            name: "تيشيرت أطفال", 
            designer: "MG", 
            price: "149.99 جنيه", 
            images: ["https://i.postimg.cc/qqmTXMKG/Chat-GPT-Image-Jun-26-2025-12-06-23-PM.png"], 
            sizes: ["4 سنوات", "6 سنوات"],
            description: "تيشيرت أطفال مريح ومناسب للأنشطة اليومية.",
            inStock: true,
            isBestSeller: true,
            category: "children"
        },
        children2: { 
            name: "بنطال أطفال", 
            designer: "MG", 
            price: "99.99 جنيه", 
            images: ["https://i.postimg.cc/qqmTXMKG/Chat-GPT-Image-Jun-26-2025-12-06-23-PM.png"], 
            sizes: ["4 سنوات", "6 سنوات"],
            description: "بنطال أطفال مريح ومناسب للأنشطة اليومية.",
            inStock: true,
            isBestSeller: false,
            category: "children"
        },
        children3: { 
            name: "جاكيت أطفال", 
            designer: "MG", 
            price: "129.99 جنيه", 
            images: ["https://i.postimg.cc/qqmTXMKG/Chat-GPT-Image-Jun-26-2025-12-06-23-PM.png"], 
            sizes: ["4 سنوات", "6 سنوات", "8 سنوات"],
            description: "جاكيت أطفال دافئ ومناسب لفصل الشتاء.",
            inStock: false,
            isBestSeller: false,
            category: "children"
        }
    };
    
    // Display best sellers section if there are any best sellers
    function displayBestSellers() {
        const bestSellersContainer = document.querySelector('.best-sellers-container');
        const bestSellers = Object.values(products).filter(product => product.isBestSeller);
        
        if (bestSellers.length > 0) {
            bestSellersContainer.style.display = 'block';
            
            // Initialize best sellers carousel
            initCategoryCarousel('best');
        } else {
            bestSellersContainer.style.display = 'none';
        }
    }
    
    // Call this function when the page loads
    displayBestSellers();
    
    // Rest of your existing code for product details, cart functionality, etc.
    // Open product details when clicking on a product
    document.querySelectorAll('.product-item').forEach(item => {
        item.addEventListener('click', function(e) {
            if (e.target.classList.contains('add-to-cart') || 
                e.target.classList.contains('sold-out-badge') ||
                e.target.classList.contains('size-option')) {
                return;
            }
            
            const productId = this.getAttribute('data-product-id');
            if (productId) {
                openProductDetails(productId);
            }
        });
    });
    
    function openProductDetails(productId) {
        const product = products[productId];
        if (!product) return;
        
        document.getElementById('productDetailsName').textContent = product.name;
        document.getElementById('productDetailsDesigner').textContent = product.designer;
        document.getElementById('productDetailsPrice').textContent = product.price;
        document.getElementById('productDetailsDescription').textContent = product.description;
        
        document.getElementById('productMainImage').src = product.images[0];
        
        const thumbnailsContainer = document.getElementById('productThumbnails');
        thumbnailsContainer.innerHTML = '';
        product.images.forEach((image, index) => {
            const thumbnail = document.createElement('img');
            thumbnail.src = image;
            thumbnail.classList.add('product-thumbnail');
            if (index === 0) thumbnail.classList.add('active');
            thumbnail.addEventListener('click', function() {
                document.getElementById('productMainImage').src = image;
                document.querySelectorAll('.product-thumbnail').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
            });
            thumbnailsContainer.appendChild(thumbnail);
        });
        
        const sizesContainer = document.getElementById('productDetailsSizes');
        sizesContainer.innerHTML = '';
        product.sizes.forEach(size => {
            const sizeOption = document.createElement('span');
            sizeOption.textContent = size;
            sizeOption.classList.add('product-details-size');
            if (size === product.sizes[0]) sizeOption.classList.add('selected');
            sizeOption.addEventListener('click', function() {
                document.querySelectorAll('.product-details-size').forEach(s => s.classList.remove('selected'));
                this.classList.add('selected');
            });
            sizesContainer.appendChild(sizeOption);
        });
        
        document.querySelector('.product-details-content').setAttribute('data-product-id', productId);
        
        const addToCartBtn = document.getElementById('addToCartFromDetails');
        if (product.inStock) {
            addToCartBtn.disabled = false;
            addToCartBtn.textContent = 'أضف إلى السلة';
        } else {
            addToCartBtn.disabled = true;
            addToCartBtn.textContent = 'نفذ';
        }
        
        document.getElementById('productDetailsModal').classList.add('active');
        document.getElementById('overlay').classList.add('active');
    }
    
    document.getElementById('closeProductDetails').addEventListener('click', function() {
        document.getElementById('productDetailsModal').classList.remove('active');
        document.getElementById('overlay').classList.remove('active');
    });
    
    document.getElementById('backToHome').addEventListener('click', function(e) {
        e.preventDefault();
        document.getElementById('productDetailsModal').classList.remove('active');
        document.getElementById('overlay').classList.remove('active');
        window.scrollTo({ top: 0, behavior: 'smooth' });
    });
    
    document.querySelectorAll('.size-option').forEach(option => {
        option.addEventListener('click', function() {
            this.parentElement.querySelectorAll('.size-option').forEach(el => {
                el.classList.remove('selected');
            });
            this.classList.add('selected');
        });
    });
    
    document.querySelectorAll('.add-to-cart').forEach(button => {
        button.addEventListener('click', function() {
            if (this.disabled) return;
            
            const productItem = this.closest('.product-item');
            const productId = productItem.getAttribute('data-product-id');
            const product = products[productId];
            
            if (!product) return;
            
            const selectedSize = productItem.querySelector('.size-option.selected').textContent;
            
            addToCart(productId, product, selectedSize);
            
            const originalText = this.textContent;
            this.textContent = 'تمت الإضافة!';
            this.style.backgroundColor = '#D4AF37';
            this.style.color = 'white';
            
            setTimeout(() => {
                this.textContent = originalText;
                this.style.backgroundColor = '';
                this.style.color = '';
            }, 1000);
        });
    });
    
    document.getElementById('addToCartFromDetails').addEventListener('click', function() {
        if (this.disabled) return;
        
        const productId = document.querySelector('.product-details-content').getAttribute('data-product-id');
        const product = products[productId];
        
        if (!product) return;
        
        const selectedSize = document.querySelector('.product-details-size.selected').textContent;
        
        addToCart(productId, product, selectedSize);
        
        const originalText = this.textContent;
        this.textContent = 'تمت الإضافة!';
        this.style.backgroundColor = '#D4AF37';
        this.style.color = 'white';
        
        setTimeout(() => {
            this.textContent = originalText;
            this.style.backgroundColor = '';
            this.style.color = '';
        }, 1000);
        
        setTimeout(() => {
            document.getElementById('productDetailsModal').classList.remove('active');
            document.getElementById('overlay').classList.remove('active');
        }, 1000);
    });
    
    function addToCart(productId, product, size) {
        const existingItem = cart.find(item => item.id === productId && item.size === size);
        
        if (existingItem) {
            existingItem.quantity += 1;
        } else {
            cart.push({
                id: productId,
                name: product.name,
                price: parseFloat(product.price),
                quantity: 1,
                size: size,
                image: product.images[0]
            });
        }
        
        updateCartCount();
    }
    
    document.getElementById('cartIcon').addEventListener('click', function() {
        updateOrderSummary();
        document.getElementById('checkoutModal').classList.add('active');
        document.getElementById('overlay').classList.add('active');
    });
    
    document.getElementById('closeCheckoutModal').addEventListener('click', function() {
        document.getElementById('checkoutModal').classList.remove('active');
        document.getElementById('overlay').classList.remove('active');
    });
    
    document.getElementById('continueShopping').addEventListener('click', function(e) {
        e.preventDefault();
        document.getElementById('checkoutModal').classList.remove('active');
        document.getElementById('overlay').classList.remove('active');
    });
    
    document.getElementById('whatsappCheckout').addEventListener('click', function(e) {
        e.preventDefault();
        
        if (cart.length === 0) {
            alert('سلة التسوق فارغة');
            return;
        }
        
        let message = "مرحبًا ب MG،\n\nأود تقديم طلب:\n\n";
        
        cart.forEach(item => {
            message += `- ${item.name} (مقاس: ${item.size}) - ${item.price} جنيه × ${item.quantity}\n`;
        });
        
        message += `\nالإجمالي: ${calculateTotal()} جنيه\n\nالرجاء تأكيد طلبي. رقم الطلب: #${generateOrderNumber()}`;
        
        const encodedMessage = encodeURIComponent(message);
        window.open(`https://wa.me/201123271234?text=${encodedMessage}`, '_blank');
        
        cart.length = 0;
        updateCartCount();
        
        document.getElementById('checkoutModal').classList.remove('active');
        document.getElementById('overlay').classList.remove('active');
    });
    
    function generateOrderNumber() {
        return Math.floor(100000 + Math.random() * 900000);
    }
    
    function updateCartCount() {
        const count = cart.reduce((total, item) => total + item.quantity, 0);
        document.getElementById('cartCount').textContent = count;
    }
    
    function calculateTotal() {
        return cart.reduce((total, item) => total + (item.price * item.quantity), 0).toFixed(2);
    }
    
    function updateOrderSummary() {
        const orderSummaryContainer = document.getElementById('orderSummary');
        orderSummaryContainer.innerHTML = '';
        
        if (cart.length === 0) {
            document.getElementById('emptyCartMessage').style.display = 'block';
            document.getElementById('orderTotal').style.display = 'none';
            document.getElementById('whatsappCheckout').style.display = 'none';
        } else {
            document.getElementById('emptyCartMessage').style.display = 'none';
            document.getElementById('orderTotal').style.display = 'block';
            document.getElementById('whatsappCheckout').style.display = 'block';
            
            cart.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.classList.add('order-item');
                
                const itemInfo = document.createElement('div');
                itemInfo.classList.add('order-item-info');
                
                const itemImage = document.createElement('img');
                itemImage.src = item.image;
                itemImage.classList.add('order-item-image');
                itemImage.alt = item.name;
                
                const itemName = document.createElement('span');
                itemName.classList.add('order-item-name');
                itemName.textContent = `${item.name} (${item.size}) × ${item.quantity}`;
                
                const itemPrice = document.createElement('span');
                itemPrice.textContent = `${(item.price * item.quantity).toFixed(2)} جنيه`;
                
                itemInfo.appendChild(itemImage);
                itemInfo.appendChild(itemName);
                
                itemElement.appendChild(itemInfo);
                itemElement.appendChild(itemPrice);
                orderSummaryContainer.appendChild(itemElement);
            });
            
            document.getElementById('orderTotal').textContent = `الإجمالي: ${calculateTotal()} جنيه`;
        }
    }
});
